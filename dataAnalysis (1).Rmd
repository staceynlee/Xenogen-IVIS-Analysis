---
title: "Xenogen Data Analysis"
author: "Stacey Lee"
date: "September 19, 2016"
output: html_document
---
### This code analyzes data generated from bioluminescence imaging of transgenic mice. The code takes txt files generated by the Xenogen IVIS analysis software from ROI measurements on each mouse. This specific experiment analysis combines a pre treatment reading, 4-day post treatment reading, and 6-day post treatment reading. I combine the datasets, add missing information about the mouse number, genotype, and day of reading, and plot the data.

```{r, warning=FALSE}
library(tidyr)
library(dplyr)
library(ggplot2)
library(plotrix)
```


```{r}
# Read and extract luminescence data
d1 <- read.table("08172016/ROImeasurements.txt")
d2 <- read.table("08222016/ROImeasurements.txt")
d3 <- read.table("08242016/ROImeasurements.txt")

# Combine datasets
df <- rbind(d1, d2, d3)
df <- tibble::rownames_to_column(df, var = "Image_Number")

# Add Mouse, Genotype, and Day data not added by the software
mouse <- rep(c("cage 8 mouse 1", "cage 8 mouse 2", "cage 8 mouse 3", "cage 8 mouse 4", "cage 14 mouse 1", "cage 14 mouse 2"), 3)
genotype = rep(c("Tg 1", "Tg 2", "Tg 3", "Tg 4", "Wt 1", "Wt 2"), 3)
day = c(rep(c("Pre"), 6), rep(c("Day 4"), 6), rep(c("Day 6"), 6))

dfClean <- df %>% mutate("Mouse" = mouse, "Genotype" = genotype, "Day" = day)

# Select Total_Flux, Genotype, and Day
names(dfClean)[names(dfClean)=="Total.Flux..p.s."] <- "Total_Flux"
df1 <- select(dfClean, Image_Number, Total_Flux, Mouse, Genotype, Day)
df1 <- arrange(df1,Day)

# Order the x-axis by day
dayOrder <- c("Pre", "Day 4", "Day 6")
df1$Day <- factor(df1$Day, levels = dayOrder)

# Plot data by Mouse
ggplot(df1, aes(x=Day, y=Total_Flux, fill=Genotype)) + geom_bar(position = "dodge", stat = "identity") +  
  labs(title = "Bioluminescence by Day",
       y = "Total Flux (p/s)") + theme(text=element_text(size=14))

# Get mean for each genotype
df2 <- df1[grep("Tg", df1$Genotype), ]
df3 <- df2 %>% group_by(Day) %>% summarize(Mean=mean(Total_Flux), SD=sd(Total_Flux), SE=std.error(Total_Flux)) %>% mutate(Genotype="Tg")
df4 <- df1[grep("Wt", df1$Genotype), ]
df5 <- df4 %>% group_by(Day) %>% summarize(Mean=mean(Total_Flux), SD=sd(Total_Flux), SE=std.error(Total_Flux)) %>% mutate(Genotype="Wt")

dfTotal <- bind_rows(df3, df5)

# Plot summary statistics
ggplot(dfTotal, aes(x=Day, y=Mean, fill=Genotype)) + geom_bar(position = "dodge", stat = "identity") +
  geom_errorbar(aes(ymax = Mean + SE, ymin=Mean - SE), position="dodge") +
  labs(title = "Bioluminescence by Day",
       y = "Average Total Flux (p/s)") + theme(text=element_text(size=18))
```
